---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit Rmd file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/"
)
```

# genekitr

**genekitr** is an R analysis toolkit based on the gene. It mainly contains five features:

- Search: Gene IDs as input then get gene-related information (exp. location, gene name, gene alias, GC content ...) as well as search gene-related PubMed records

- Transform: Transform gene ID type among "symbol", "entrezid", "ensembl" and "uniprot"

- Analysis: Gene enrichment analysis including ORA (GO and KEGG) and GSEA

- Visualize: Visualization for enrichment analysis and gene overlaps

- Export: Gene IDs and analysis results could be exported as various sheets in one Excel file, which could be easily read and shared with others

**Why develop this R package?**


用户痛点：

- ID转换不够全，很多gene alias 不能够被识别（比如huamn 的BCC7实际对应TP53，mouse的Tp53实际可能对应Trp53, Trp53inp2 & Ano9）;
  另外，像是一些常见的gene symbol（如PD1、PDL1），实际上它们的gene id是PDCD1和CD274，很多表达矩阵中可能因此就忽略掉这些基因

- 基因ID转换支持物种太少，有些工具只支持模式物种。我们可以支持198个物种

- 目前很多函数的参数设置不够友好，太繁琐（我们允许用户只输入基因id，至于它是symbol、entrez还是其他，函数可以自行判断）

- 保持和数据库的同步（ensembl、Uniprot），使用最新的ensemble v104版本（后期还可同步更新）
  然后protein id也随着uniprot数据库更新

- 很多函数导出的结果是一个对象（Object），而不是数据框（dataframe），如果用户想自行挑选terms，就比较麻烦；为此，我们的函数全面支持数据框，直接将数据框给到作图函数，便可轻松绘制，而且绘制的图形也尽可能简洁，比较贴近发表级，后期用户只需要简单AI修改即可


## Table of Contents

* [Installation](#installation)
* [Quick guide](#quick-guide)
* [Vignette](#vignette)
* [Citation](#citation)
* [Welcome to contribute](#welcome-to-contribute)

## Installation

Install CRAN stable version:

```{r, eval=FALSE}
install.packages("genekitr")
```

Install GitHub dev version:

```{r install-github, eval = FALSE}
# install.packages("remotes")
remotes::install_github("GangLiLab/genekitr")
# To build local vignette:
# remotes::install_github("GangLiLab/genekitr", build_vignettes = TRUE, dependencies = TRUE)
```

## Quick guide

To quickly go through the package usage, we will use built-in gene list from GEO airway

([GSE52778](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE52778)) DEG analysis.

### Search 

##### Search gene related information

`org` argument could accept fullname or shortname of specific organism. For example, we could 

use common name: `human/hs/hg/hsa` to describe human.

```{r geninfo}
library(genekitr)
data(geneList)
id = names(geneList)[1:100]
head(id)
ginfo = genInfo(id, org = 'human')
DT::datatable(ginfo, options = list(pageLength = 5))
```

##### Get specific type genes

For example, we want to retrieve all human protein-coding ids. Just leave argument `id` empty.

```{r}
pro_hg = genInfo(org = 'human') %>% 
  dplyr::filter(gene_biotype  == 'protein_coding') %>% dplyr::pull(symbol)
head(pro_hg) 
# number of human protein id
length(pro_hg)
```


##### Search gene PubMed records

```{r genpubmed}
pub = genPubmed(
  id = c("Cyp2c23", "Fhit", "Gal3st2b","Insl3", "Gbp4"),
  keywords = "stem cell", field = "tiab")
DT::datatable(pub, options = list(pageLength = 5))
```


### Transform

Regardless of input ID type, function will detect automatically.

User only need to specify which type you want, the left things just give `transId`.

##### Transform ID from entrezid to symbol

```{r transid}
id[1:5]
transId(id[1:5], trans_to = 'symbol',org='hs')
```

##### Transform gene alias
```{r alias}
transId(c('BCC7','PDL1','PD1'), trans_to = 'symbol',org='human')

# We could get all matched id when one-to-many occurs
transId(c('BCC7','PDL1','PD1'), trans_to = 'symbol',org='hg',unique = F)
```

##### Transform protein id to gene id
```{r}
# to symbol
transId(c('Q12879','Q86V25','Q8N386','Q5T7N3'),'sym','hs')
# to ensembl
transId(c('Q12879','Q86V25','Q8N386','Q5T7N3'),'ens','hs')
```

##### Transform ensembl id to symbol 
```{r}
transId(c('ENSG00000146006','ENSG00000134321','ENSG00000136267','ENSG00000105989'),'sym','hg')
```

##### Transform ensembl id to protein id

```{r}
transId(c('ENSG00000146006','ENSG00000134321','ENSG00000136267','ENSG00000105989'),'uniprot','hg')
```



### Analysis 

All enrichment analysis ** just give a gene list ** (especially GSEA need the gene list with a decreasing fold change)

#### over representation analysis (ORA)

##### GO analysis 

User could choose ontology among "bp", "cc", "mf" or "all".

If set `use_symbol = TRUE`, the result will return gene symbol for easy understanding.

If you are not sure the organism name, please type `biocOrg_name` and choose full name or short name

```{r warning=FALSE}
ego_bp = genGO(id[1:100], org = 'human', ont = 'bp',pvalueCutoff = 0.05,qvalueCutoff = 0.05, use_symbol = T)

# user could choose all three ontology
ego_all = genGO(id[1:100], org = 'human', ont = 'all',pvalueCutoff = 0.05,qvalueCutoff = 0.05, use_symbol = T)

```

##### KEGG analysis 

If you are not sure the organism name, please type `keggOrg_name` and choose full name or short name

```{r}
ekeg = genKEGG(id, org = 'hg',use_symbol = T)

# If we want to compare different groups of genes, we only need to add a gene group list
group = list(groupA = c(rep("up",50),rep("down",50)),
             groupB = c(rep("A",30), rep("B",70)))
ekeg_compare =  genKEGG(c(head(id,50),tail(id,50)), group_list = group,
                    org = 'human',pvalueCutoff = 0.15,qvalueCutoff = 0.15, use_symbol = T)
```

#### gene set enrichment analysis (GSEA) analysis 

`category` argument could choose from 'C1','C2','C3', 'C4','C5','C6','C7','C8' and 'H'

If you are not sure `subcategory`, you can only choose `category` and leave `subcategory` as blank. 

The message will tell what options you could choose in the main `category`.

```{r}
egsea = genGSEA(genelist = geneList,org = 'hs', 
                category = "H",
                use_symbol = T, pvalueCutoff = 1)
```


### Visulaize 

##### Gene overlap

If we only have two or three groups of genes, the function will plot Venn diagram;

If we have at least four groups of genes, the default option will be UpSet diagram.

```{r venn, fig.height = 4}
# if only have three groups
set1 <- paste0(rep("gene", 100), sample(c(1:1000), 100))
set2 <- paste0(rep("gene", 100), sample(c(1:1000), 100))
set3 <- paste0(rep("gene", 100), sample(c(1:1000), 100))
sm_gene_list <- list(gset1 = set1, gset2 = set2, gset3 = set3)
plotVenn(sm_gene_list,
  text_size = 1.5, alpha_degree = 1,
  remove_grid = TRUE)

# if only have five groups
set4 <- paste0(rep("gene", 100), sample(c(1:1000), 100))
set5 <- paste0(rep("gene", 100), sample(c(1:1000), 100))
la_gene_list <- list(gset1 = set1, gset2 = set2, gset3 = set3,
  gset4 = set4, gset5 = set5)
plotVenn(la_gene_list,
  text_size = 15, alpha_degree = 0.2, border_thick = 2,
  remove_grid = TRUE, use_venn = FALSE)

```

##### Enrichment plot

- Support barplot, dotplot

- x-axis support: GeneRatio/Count/FoldEnrich

- stats support: pvalue/p.adjust/qvalue(FDR)

- easily modify plot line & text pattern

```{r enrich_bar1, fig.height = 4}
plotEnrich(ego_bp,plot_type = 'bar',remove_grid = T, main_text_size = 8,
  legend_text_size = 6,border_thick = 1.5)
```
```{r enrich_bar2, fig.height = 4}
plotEnrich(ego_all,plot_type = 'bar', xlab_type = 'GeneRatio',legend_type = 'qvalue',
           remove_grid = T, main_text_size = 8, legend_text_size = 6,border_thick = 1.5)
```

##### Enrichment dotplot

```{r enrich_dot, fig.height = 4}
plotEnrich(ego_bp,plot_type = 'dot',xlab_type = 'GeneRatio',legend_type = 'qvalue',
          remove_grid = T, main_text_size = 8, legend_text_size = 6)
```

```{r enrich_dot2, fig.height = 4}
plotEnrich(ekeg_compare)
```

##### gsea plot

- support: volcano/classic/multi-pathway(fgsea)

```{r gsea, fig.height = 4}
plotGSEA(egsea,plot_type = 'volcano', show_pathway = 3)
plotGSEA(egsea, plot_type = 'classic', show_pathway = c("HALLMARK_UV_RESPONSE_DN","HALLMARK_INTERFERON_ALPHA_RESPONSE"),
         show_genes = c("SELL"))

# default shows top3 up & down pathways
plotGSEA(egsea, plot_type = 'fgsea')
```


### Export 

If you want to export many data sets in one file, you could use `expoSheet`

For example, since we got 100 genes' GO and KEGG result, then we want to export them with gene information:

```{r eval=FALSE}
expoSheet(
  dat_list = list(ginfo, ego_bp, ego_all,ekeg), name_list = list("GeneInfo","GO-BP", "GO-All","KEGG"),
  filename = "gene_enrich.xlsx", dir = tempdir())
```

The result will be:

<img src='man/figures/exp0.png' height="500" alt="exp0"/>


## Vignette

### English 

- Wait to update...

### 中文区 (推文专区)

- 待更新1：R包搞定你的基因需求


## Citation

Wait for paper ...


## Welcome to contribute

If you are interested in this tool, welcome contribute your ideas as follows:

* Git clone this project
* Double click `genekitr.Rproj` to open RStudio
* Modify source code in `R/` folder
* Run `devtools::check()` to make sure no errors, warnings or notes
* Pull request and describe clearly your changes








